<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>å¯æ¨‚å¤©æ°£</title>
  <link rel="icon" type="image/png" href="./icon-v2.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hachi+Maru+Pop&family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      /* æ´»æ½‘æ˜äº®çš„æµ·æ´‹è—ä¸»é¡Œ */
      --mer-blue-1: #DFF8FF;    /* èƒŒæ™¯æ·ºè— */
      --mer-blue-2: #5FD6FF;    /* æ´»æ½‘æ·ºè— */
      --mer-blue-3: #00A8E8;    /* é®®è±”æµ·è—ï¼ˆä¸»è‰²ï¼‰ */
      --mer-blue-4: #0077C8;    /* æ·±æµ·è—ï¼ˆé»ç¶´ï¼‰ */
      --mer-coral:  #FF6B81;    /* æ˜äº®çŠç‘šé»ç¶´ */
      --mer-pearl:  #FFFFFF;    /* å¡ç‰‡ç™½ */
      --mer-text:   #0F3950;    /* æ–‡å­—æ·±è‰² */
      --mer-border: #BEEBFF;
      --fancy: 'Hachi Maru Pop', cursive;
      --sans: 'Zen Maru Gothic', sans-serif;
    }

    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      font-family:var(--sans);
      background-color:var(--mer-blue-1);
      color:var(--mer-text);
      min-height:100vh;
      overflow-x:hidden;
      padding-bottom:28px;

      /* èƒŒæ™¯ï¼šæ›´é£½å’Œçš„æ°£æ³¡èˆ‡æµ·æµª pattern */
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='360' height='360' viewBox='0 0 360 360'%3E%3Crect width='100%25' height='100%25' fill='%23DFF8FF'/%3E%3Cg opacity='0.98'%3E%3Ccircle cx='50' cy='40' r='18' fill='%23FFFFFF'/%3E%3Cellipse cx='120' cy='55' rx='32' ry='16' fill='%23FFFFFF'/%3E%3Ccircle cx='240' cy='80' r='14' fill='%23FFFFFF'/%3E%3C/g%3E%3Cg opacity='0.28' fill='%235FD6FF'%3E%3Ccircle cx='20' cy='260' r='5'/%3E%3Ccircle cx='300' cy='200' r='7'/%3E%3C/g%3E%3Cg opacity='0.14'%3E%3Cpath d='M20 220 q28 -40 80 -22 q52 18 96 -12' stroke='%2300A8E8' stroke-width='2.2' fill='none'/%3E%3C/g%3E%3C/svg%3E");
      background-repeat: repeat;
      background-size: 420px 420px;
      background-attachment: fixed;
    }

    /* ç‹€æ…‹åˆ— */
    .status-bar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 20px;
      position:sticky;
      top:0;
      z-index:100;
      background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.86));
      backdrop-filter: blur(6px);
      border-bottom:2px solid var(--mer-border);
      box-shadow:0 8px 28px rgba(0,120,200,0.07);
    }
    .location-pill{
      background: linear-gradient(135deg, var(--mer-pearl), #F3FBFF);
      color:var(--mer-blue-4);
      padding:7px 18px;
      border-radius:24px;
      font-weight:900;
      font-size:1.06rem;
      border:2px solid white;
      box-shadow:0 4px 0 rgba(0,0,0,0.06);
      font-family:var(--fancy);
      letter-spacing:0.6px;
    }
    .update-pill{
      font-size:0.85rem;
      color:var(--mer-blue-4);
      background:linear-gradient(180deg, #FFFFFF, rgba(255,255,255,0.95));
      padding:6px 14px;
      border-radius:14px;
      border:1px solid var(--mer-border);
      font-weight:700;
    }

    .container{padding:22px;max-width:760px;margin:0 auto}

    /* Hero card */
    .hero-card{
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,255,255,0.98));
      border-radius:34px;
      padding:28px;
      text-align:center;
      box-shadow:0 26px 48px rgba(0,120,200,0.08);
      border:3px solid rgba(255,255,255,0.92);
      margin-bottom:22px;
      position:relative;
      overflow:visible;
    }
    .hero-period{
      position:absolute;
      top:-20px;
      left:50%;
      transform:translateX(-50%);
      background:linear-gradient(135deg,var(--mer-blue-3),var(--mer-blue-2));
      color:white;
      padding:8px 18px;
      border-radius:20px;
      font-weight:900;
      border:3px solid white;
      box-shadow:0 8px 0 rgba(0,0,0,0.06);
      font-family:var(--fancy);
    }

    .hero-temp-container{display:flex;justify-content:center;align-items:center;gap:14px;margin:18px 0}
    .hero-icon{font-size:5.6rem; filter:drop-shadow(0 8px 0 rgba(0,120,200,0.06)); animation:floatMer 3s ease-in-out infinite}
    @keyframes floatMer{0%,100%{transform:translateY(0) rotate(-4deg)}50%{transform:translateY(-12px) rotate(4deg)}}
    .hero-temp{font-size:4.8rem;font-weight:900;color:var(--mer-blue-4);line-height:1;font-family:var(--fancy)}
    .hero-desc{font-size:1.3rem;color:var(--mer-blue-4);margin-bottom:16px;font-weight:900;font-family:var(--fancy)}

    /* æ›´æ´»æ½‘çš„æ­£èƒ½é‡çŸ­å¥ */
    .boost{
      font-size:0.98rem;color:#0A4E6B;font-weight:800;margin-bottom:12px;
      background:linear-gradient(90deg, rgba(95,214,255,0.07), rgba(255,107,129,0.04));
      padding:8px 12px;border-radius:12px;display:inline-block;font-family:var(--fancy)
    }

    /* äººé­šå°¾å·´è£é£¾ï¼ˆæ›´é®®è±”ï¼‰ */
    .mer-tail{
      position:absolute;
      right:10px;
      bottom:-22px;
      width:110px;
      height:110px;
      transform:rotate(12deg);
      opacity:0.98;
      filter:drop-shadow(0 10px 18px rgba(0,110,190,0.08));
      pointer-events:none;
      animation:tailW 2.8s ease-in-out infinite;
    }
    @keyframes tailW{0%{transform:translateY(0) rotate(8deg)}50%{transform:translateY(-10px) rotate(-8deg)}100%{transform:translateY(0) rotate(8deg)}}

    /* å»ºè­°å€ */
    .advice-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:16px;padding-top:16px;border-top:2px dashed var(--mer-border)}
    .advice-item{display:flex;flex-direction:column;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.99), rgba(253,255,255,1));padding:12px;border-radius:18px;border:2px solid white;box-shadow:0 12px 26px rgba(0,120,200,0.03)}
    .advice-icon{font-size:2rem;margin-bottom:8px}
    .advice-text{font-size:1.18rem;font-weight:900;color:var(--mer-blue-4);margin:6px 0;line-height:1.2;font-family:var(--fancy)}

    /* æ©«å‘æ»‘å‹• */
    .section-title{font-size:1.15rem;color:var(--mer-blue-4);margin-bottom:12px;margin-left:8px;font-weight:900;font-family:var(--fancy)}
    .scroll-container{display:flex;overflow-x:auto;gap:14px;padding-bottom:10px;scrollbar-width:none;-ms-overflow-style:none}
    .scroll-container::-webkit-scrollbar{display:none}
    .mini-card{min-width:150px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(248,255,255,0.98));border-radius:22px;padding:18px 12px;text-align:center;border:2px solid var(--mer-border);flex-shrink:0;box-shadow:0 14px 30px rgba(0,120,200,0.03)}
    .mini-time{background:linear-gradient(135deg,var(--mer-blue-3),var(--mer-blue-2));color:white;padding:6px 12px;border-radius:12px;font-size:0.82rem;display:inline-block;margin-bottom:10px;font-weight:800;font-family:var(--fancy)}
    .mini-icon{font-size:2.6rem;margin:6px 0}
    .mini-temp{font-size:1.15rem;font-weight:900;color:var(--mer-blue-4);font-family:var(--fancy)}

    /* Loading */
    .loading-screen{position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(180deg,var(--mer-blue-1),#CFF7FF);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:999;font-family:var(--fancy);color:var(--mer-blue-4)}
    .mer-bubble{font-size:3.6rem;animation:bubbleUp 2.4s ease-in-out infinite;filter:drop-shadow(0 8px 0 rgba(0,120,200,0.06))}
    @keyframes bubbleUp{0%{transform:translateY(0)}50%{transform:translateY(-14px)}100%{transform:translateY(0)}}

    /* å°è¢å¹•å¾®èª¿ */
    @media (max-width:420px){
      .hero-temp{font-size:3.4rem}
      .hero-icon{font-size:4.4rem}
      .container{padding:14px}
      .mer-tail{width:84px;height:84px;right:6px}
      .mini-card{min-width:130px}
    }
  </style>
</head>
<body>
  <div id="loading" class="loading-screen">
    <div class="mer-bubble">ğŸ§œâ€â™€ï¸âœ¨</div>
    <p style="font-weight:900;margin-top:18px;font-size:1.06rem">äººé­šæ¼¢é “åœ¨æ¡é›†æœ€äº®çš„å¤©æ°£æ³¡æ³¡ï¼</p>
  </div>

  <div class="status-bar">
    <div class="location-pill">ğŸ“ æ–°åŒ—</div>
    <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
  </div>

  <div class="container" id="mainContent" style="display:none;">
    <div id="heroCard"></div>

    <h3 class="section-title">ä»Šæ—¥ã®æµ·æ³ï¼ˆä»Šå¤©å¤©æ°£ï¼‰</h3>
    <div class="scroll-container" id="futureForecasts"></div>
  </div>

  <script>
    const API_URL = "https://cwaweather-tapai.zeabur.app/api/weather/kaohsiung";

    function getWeatherIcon(weather){
      if(!weather) return "ğŸ§œâ€â™€ï¸";
      if(weather.includes("æ™´")) return "ğŸŒ";
      if(weather.includes("å¤šé›²")) return "â›…";
      if(weather.includes("é™°")) return "ğŸŒ«ï¸";
      if(weather.includes("é›¨")) return "ğŸŒ§ï¸";
      if(weather.includes("é›·")) return "âš¡";
      return "ğŸš";
    }

    function getDailyBoost(){
      const phrases = [
        "åƒæµ·æµªä¸€æ¨£å‹‡å¾€ç›´å‰ ğŸŒŠ",
        "æŠŠç…©æƒ±äº¤çµ¦æµ·é¢¨ï¼Œå¾®ç¬‘å‡ºèˆª ğŸ˜Š",
        "ä»Šå¤©ä¹Ÿè¦åƒæµ·é¢ä¸€æ¨£é–ƒäº® âœ¨",
        "å‹‡æ•¢æ½›æ°´ä¸€æ¬¡ï¼Œæ”¶ç©«æ–°æ™¯è‰² ğŸš",
        "æº«æŸ”å‰è¡Œï¼Œåƒæµ·æ°´æ“æŠ±æ²™ç˜ ğŸ’§",
        "å°æ­¥å‰é€²ï¼Œçµ‚æœƒæŠµé”å½¼å²¸ ğŸŒ…",
        "æŠŠé¡˜æœ›æ”¾ç“¶ä¸­ï¼Œè®“æµ·æµªå¸¶èµ° ğŸƒ"
      ];
      return phrases[Math.floor(Math.random()*phrases.length)];
    }

    function getAdvice(rainProb, maxTemp){
      let rainIcon="ğŸš", rainText="çœ‹èµ·ä¾†ç©©å®š";
      if(parseInt(rainProb) > 30){ rainIcon="ğŸŒ§ï¸"; rainText="å¯èƒ½æœƒä¸‹é›¨ï¼Œå¸¶æŠŠå°å‚˜å–”"; }
      let clothIcon="ğŸ§¥", clothText="è¼•è–„å¤–å¥—";
      if(parseInt(maxTemp) >= 28){ clothIcon="ğŸ‘™"; clothText="çŸ­è¢–/è–„è¡«æœ€èˆ’é©";}
      else if(parseInt(maxTemp) <= 20){ clothIcon="ğŸ§£"; clothText="å†·è«‹å¤šåŠ ä¸€ä»¶";}
      return { rainIcon, rainText, clothIcon, clothText };
    }

    function getTimePeriod(startTime){
      const hour = new Date(startTime).getHours();
      if(hour>=5 && hour<11) return "æ—©ä¸Š";
      if(hour>=11 && hour<14) return "ä¸­åˆ";
      if(hour>=14 && hour<18) return "ä¸‹åˆ";
      if(hour>=18 && hour<23) return "æ™šä¸Š";
      return "æ·±å¤œ";
    }

    function renderWeather(data){
      const forecasts = data.forecasts;
      const current = forecasts[0];
      const others = forecasts.slice(1);

      const advice = getAdvice(current.rain, current.maxTemp);
      const period = getTimePeriod(current.startTime);
      const avgTemp = Math.round((parseInt(current.maxTemp)+parseInt(current.minTemp))/2);

      document.getElementById('heroCard').innerHTML = `
        <div class="hero-card">
          <div class="hero-period">${period}</div>
          <div class="hero-temp-container">
            <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
            <div class="hero-temp">${avgTemp}Â°</div>
          </div>
          <div class="hero-desc">${current.weather}</div>

          <div class="boost">${getDailyBoost()}</div>

          <div class="advice-grid">
            <div class="advice-item">
              <div class="advice-icon">${advice.rainIcon}</div>
              <div class="advice-text">${advice.rainText}</div>
              <div style="font-size:0.78rem;color:#48788f;font-family:var(--sans)">ğŸ’§ ${current.rain}%</div>
            </div>
            <div class="advice-item">
              <div class="advice-icon">${advice.clothIcon}</div>
              <div class="advice-text">${advice.clothText}</div>
              <div style="font-size:0.78rem;color:#48788f;font-family:var(--sans)">æœ€é«˜ ${current.maxTemp}Â°</div>
            </div>
          </div>

          <!-- äººé­šå°¾å·´ SVGï¼ˆæ›´é®®è±”ï¼‰ -->
          <svg class="mer-tail" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="#5FD6FF"/>
                <stop offset="1" stop-color="#00A8E8"/>
              </linearGradient>
              <linearGradient id="g2" x1="0" x2="1">
                <stop offset="0" stop-color="#FF9AA2" stop-opacity="0.18"/>
                <stop offset="1" stop-color="#FF6B81" stop-opacity="0.12"/>
              </linearGradient>
            </defs>
            <path d="M12 44c8-14 28-20 46-8c-8 12-26 28-46 8z" fill="url(#g1)" opacity="0.98"/>
            <path d="M40 46c8-8 16-12 22-8c-6 8-12 14-22 8z" fill="url(#g2)" opacity="0.92"/>
          </svg>
        </div>
      `;

      const scrollContainer = document.getElementById('futureForecasts');
      scrollContainer.innerHTML = '';
      const todayDate = new Date().getDate();

      others.forEach(f=>{
        let p = getTimePeriod(f.startTime);
        const fDate = new Date(f.startTime);
        if(fDate.getDate() !== todayDate) p = "æ˜å¤©" + p;

        scrollContainer.innerHTML += `
          <div class="mini-card">
            <div class="mini-time">${p}</div>
            <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
            <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
            <div style="font-size:0.82rem;color:#48788f;margin-top:6px;font-family:var(--sans)">ğŸ’§ ${f.rain}%</div>
          </div>
        `;
      });

      const now = new Date();
      const month = now.getMonth()+1;
      const date = now.getDate();
      const dayIndex = now.getDay();
      const days = ["é€±æ—¥","é€±ä¸€","é€±äºŒ","é€±ä¸‰","é€±å››","é€±äº”","é€±å…­"];
      document.getElementById('updateTime').textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
    }

    async function fetchWeather(){
      try{
        const delay = new Promise(res=>setTimeout(res,850));
        const resp = fetch(API_URL).then(r=>r.json());
        const [_, json] = await Promise.all([delay, resp]);
        if(json.success){
          renderWeather(json.data);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('mainContent').style.display = 'block';
        } else throw new Error('API error');
      }catch(e){
        console.error(e);
        alert('äººé­šæ¼¢é “æ‰¾ä¸åˆ°å¤©æ°£æ³¡æ³¡äº†ï½è«‹ç¨å¾Œå†è©¦ ğŸš');
      }
    }

    document.addEventListener('DOMContentLoaded', fetchWeather);
  </script>
</body>
</html>
